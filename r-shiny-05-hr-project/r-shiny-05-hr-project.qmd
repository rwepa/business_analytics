---
format:
  revealjs: 
    theme: default
    menu: false
    slide-number: true
    code-line-numbers: true
    code-overflow: wrap
    code-block-bg: true
editor: visual
---

## RWEPA \| R - shinyä¼æ¥­å¯¦å‹™æ‡‰ç”¨ {background-color="#002060"}

[ç¬¬5é›†-shinyå°æ˜ç®—å‘½å¸«(ä¸Š)]{style="color: #FFC000; font-size: 1.5em;"}

::: columns
::: {.column width="55%"}
-   æŒ‰ è¨‚é–±ã€è®šã€é–‹å•Ÿå°éˆ´éº
-   <a href="https://youtube.com/@alan9956" target="_blank">https://youtube.com/@alan9956</a>
-   <a href="http://rwepa.blogspot.com/" target="_blank">http://rwepa.blogspot.com/</a> ![](images/tail_3_icons.png)
:::

::: {.column width="45%"}
Business Data Analytics ![](images/r-shiny-wordcloud2.png)
:::
:::

## å¤§ç¶±

5.1 å¥—ä»¶ç¸½è¦½

5.2 Excelæª”æ¡ˆåŒ¯å…¥

5.3 è³‡æ–™è½‰æ›èˆ‡è¦–è¦ºåŒ–

5.4 å»ºç«‹é æ¸¬æ¨¡å‹

5.5 ç¿’é¡Œ-**Rèˆ‡å°æ˜ç®—å‘½å¸«-shinyå¯¦ä½œç¯‡**

5.6 çµè«–

## 5.1 å¥—ä»¶ç¸½è¦½ {.smaller}

-   æœå°‹å¥—ä»¶: r cran å¥—ä»¶åç¨±, ä¾‹: Google --> r cran readr

-   ROCæ›²ç·šç¹ªåœ–: <a href="http://rwepa.blogspot.com/2013/01/rocr-roc-curve.html" target="_blank">http://rwepa.blogspot.com/2013/01/rocr-roc-curve.html</a>

-   å¥—ä»¶åŠŸèƒ½è¡¨

|å¥—ä»¶        |åŠŸèƒ½                               |
|------------|-----------------------------------|
|readr       |åŒ¯å…¥æ–‡å­—æª”æ¡ˆ,ä¾‹:'csv', 'tsv', 'fwf'|
|dplyr       |è³‡æ–™è½‰æ›                           |
|ggcorrplot  |ç›¸é—œçŸ©é™£ç¹ªåœ–                       |
|ggplot2     |ç¹ªåœ–                               |
|randomForest|éš¨æ©Ÿæ£®æ—                           |
|caret       |åˆ†é¡,è¿´æ­¸                          |
|pROC        |ROCæ›²ç·šç¹ªåœ–                        |

## è¼‰å…¥å¥—ä»¶
```{r}
#| eval: true
#| echo: true
library(readr) # read_csv
library(dplyr) # mutate_if, mutate, group_by, summarise, select, rename_with
library(ggcorrplot)   # ggcorrplot
library(ggplot2)      # ggplot
library(randomForest) # randomForest, importance, varImpPlot
library(caret)        # trainControl, train
library(pROC)         # plot.roc
```

## 5.2 Excelæª”æ¡ˆåŒ¯å…¥ {style="font-size: 75%;"}

-   äººåŠ›è³‡æºè³‡æ–™é›†èªªæ˜: <a href="https://github.com/rwepa/DataDemo#human_resourcecsv" target="_blank">https://github.com/rwepa/DataDemo#human_resourcecsv</a>

-   ä¸‹è¼‰: <a href="https://github.com/rwepa/DataDemo/blob/master/human_resource.csv" target="_blank">https://github.com/rwepa/DataDemo/blob/master/human_resource.csv</a>

```{r}
#| eval: true
#| echo: true
# è¼‰å…¥äººåŠ›è³‡æºè³‡æ–™é›†
urls <- "https://raw.githubusercontent.com/rwepa/DataDemo/master/human_resource.csv"
df <- read_csv(urls)
df # A tibble: 14,999 Ã— 10
```

## 5.3 è³‡æ–™è½‰æ›èˆ‡è¦–è¦ºåŒ–

-  è³‡æ–™çµæ§‹ str

-  è³‡æ–™æ‘˜è¦ summary

-  è³‡æ–™è½‰æ› mutate_if, mutate

-  leftç¾¤çµ„ç™¾åˆ†æ¯”, leftç¾¤çµ„çš„è®Šæ•¸å¹³å‡å€¼

-  ç›¸é—œä¿‚æ•¸çŸ©é™£åœ–,leftç¾¤çµ„ç›’é¬šåœ–

## è³‡æ–™çµæ§‹ {.smaller}
```{r}
#| eval: true
#| echo: true
str(df) # left: numæ•¸å€¼, role, salary: chrå­—å…ƒ
```

## è³‡æ–™æ‘˜è¦ {.smaller}
```{r}
#| eval: true
#| echo: true
summary(df) # è³‡æ–™æ²’æœ‰NA
```

## è³‡æ–™è½‰æ›
```{r}
#| eval: true
#| echo: true
# è³‡æ–™è½‰æ›
df <- df %>%
  mutate_if(is.character, as.factor) %>% # è½‰æ› character ç‚º factor
  mutate(left=factor(left, labels=c("No","Yes")))
str(df)
```

## leftç¾¤çµ„ç™¾åˆ†æ¯”

```{r}
#| eval: true
#| echo: true
df %>%
  group_by(left) %>% # å»ºç«‹ä¾leftç‚ºç¾¤çµ„
  summarise(Count = n()) %>% # å»ºç«‹ç¾¤çµ„ç¸½è¨ˆCount
  mutate(Freq = round(Count / sum(Count), 2)) #å»ºç«‹ç¾¤çµ„ç™¾åˆ†æ¯”Freq
```


## leftç¾¤çµ„çš„è®Šæ•¸å¹³å‡å€¼

```{r}
#| eval: true
#| echo: true
df %>%
  select(-c(role, salary)) %>% # åˆªé™¤ role, salary äºŒå€‹æ¬„ä½
  group_by(left) %>% # ä¾leftå»ºç«‹ç¾¤çµ„
  summarise(across(everything(), list(mean))) %>% # è¨ˆç®—å„ç¾¤çµ„çš„å¹³å‡å€¼
  rename_with(~ tolower(gsub("_1", "_mean", .x, fixed = TRUE))) # æ›´æ”¹æ¬„ä½åç¨±
```

## ç›¸é—œä¿‚æ•¸

```{r}
#| eval: true
#| echo: true
corr <- cor(as.data.frame(df %>% select(-c(role, salary, left))))
corr
```

## ç›¸é—œä¿‚æ•¸çŸ©é™£åœ–
```{r}
#| eval: true
#| echo: true
ggcorrplot(corr, lab = TRUE, colors=c("sienna1","white","deepskyblue3")) +
  ggtitle("äººåŠ›è³‡æºç›¸é—œä¿‚æ•¸çŸ©é™£åœ–") +
  theme(plot.title = element_text(hjust = 0.5))
```

## å“¡å·¥å·¥ä½œæ»¿æ„åº¦-leftç¾¤çµ„ç›’é¬šåœ–
```{r}
#| eval: true
#| echo: true
ggplot(aes(y = satisfaction_level, x = left), data = df) + 
  geom_boxplot() +
  ggtitle("å“¡å·¥å·¥ä½œæ»¿æ„åº¦-leftç¾¤çµ„ç›’é¬šåœ–") +
  theme(plot.title = element_text(hjust = 0.5))
```

## æ•´é«”vs.é›¢è·å“¡å·¥å¹³å‡å·¥ä½œæ»¿æ„åº¦

```{r}
#| eval: true
#| echo: true
# æ•´é«”å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦
emp_population_satisfaction <- mean(df$satisfaction_level)

# é›¢è·å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦
left_pop <- subset(df, left == "Yes")
emp_turnover_satisfaction <- mean(left_pop$satisfaction_level)

print(paste(c('æ•´é«”å“¡å·¥çš„å·¥ä½œæ»¿æ„åº¦: ', 
              round(emp_population_satisfaction, 4)*100, '%'), 
            collapse =""))
print(paste(c('é›¢è·å“¡å·¥çš„å·¥ä½œæ»¿æ„åº¦: ', 
              round(emp_turnover_satisfaction, 4)*100, '%'), 
            collapse =""))
```

## Tæª¢å®š-æ•´é«”vs.é›¢è·å¹³å‡å·¥ä½œæ»¿æ„åº¦ {.smaller}
```{r}
#| eval: true
#| echo: true
# Tæª¢å®š-æ¯”è¼ƒæ•´é«”å“¡å·¥èˆ‡é›¢è·å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦
# H0: é›¢è·å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦ç­‰æ–¼æ•´é«”å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦
# H1: é›¢è·å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦ä¸ç­‰æ–¼æ•´é«”å“¡å·¥çš„å¹³å‡å·¥ä½œæ»¿æ„åº¦
ttest_satisfaction <- t.test(x=left_pop$satisfaction_level, mu=emp_population_satisfaction)
ttest_satisfaction

if (ttest_satisfaction$p.value <= 0.05) {
  print("Rejet H0")
} else {
  print("Do not reject H0")
}
```

## 5.4 å»ºç«‹é æ¸¬æ¨¡å‹

-   ç‰¹å¾µé‡è¦æ€§ç¹ªåœ–

-   å»ºç«‹è¨“ç·´é›†(70%),æ¸¬è©¦é›†(30%)

-   å»ºç«‹ç›£ç£å¼å­¸ç¿’æ¨¡å‹

## ç‰¹å¾µé‡è¦æ€§
```{r}
#| eval: true
#| echo: true
# ä½¿ç”¨éš¨æ©Ÿæ£®æ—(random forest)
df_rf <- randomForest(left~., data=df)

# ç‰¹å¾µé‡è¦æ€§(feature importance)
importance(df_rf)
```

## ç‰¹å¾µé‡è¦æ€§ç¹ªåœ–

```{r}
#| eval: true
#| echo: true
# ç‰¹å¾µé‡è¦æ€§ç¹ªåœ–(feature importance plot)
varImpPlot(df_rf, pch = 16, main="äººåŠ›è³‡æºç‰¹å¾µé‡è¦æ€§ç¹ªåœ–")
```

## å»ºç«‹è¨“ç·´é›†(70%),æ¸¬è©¦é›†(30%) {style="font-size: 90%;"}
```{r}
#| eval: true
#| echo: true
set.seed(168)
trainIndex <- createDataPartition(df$left, p = 0.7, list = FALSE)
train <- df[trainIndex,]
head(train, n=3)

test <- df[-trainIndex,] # ä½¿ç”¨è² è™Ÿ
head(test, n=3)
```

## å»ºç«‹ç›£ç£å¼å­¸ç¿’æ¨¡å‹ {style="font-size: 90%;"}
```{r}
#| eval: true
#| echo: true
set.seed(168)

fitControl <- trainControl(
  method = "repeatedcv",
  number = 10,
  summaryFunction = twoClassSummary, 
  classProbs = TRUE,
  savePredictions = TRUE)

model <- function(usedmethod, data_train, data_test) {
  myformula <- as.formula("left ~ .")
  tmp <- train(myformula, # ä½¿ç”¨ train é€²è¡Œæ¨¡å‹è¨“ç·´
               data = data_train, 
               trControl = fitControl, 
               method = usedmethod)
  
  mymodel <- list(trainmodel=tmp, # ï¼œæŠ€å·§ï¼ä½¿ç”¨listå›å‚³æ¨¡å‹çµæœèˆ‡æ­£ç¢ºç‡
                  accuracy=mean(data_test$left == predict(tmp, data_test)))
  return(mymodel)
}
```

## æ–¹æ³•1: å»£ç¾©ç·šæ€§æ¨¡å‹(GLM)

```{r}
#| eval: true
#| echo: true
model_glm <- model("glm", train, test)

# é¡¯ç¤º summary, accuracy
# summary(model_glm$trainmodel)
model_glm$accuracy  # 0.7879529

# Plot roc curve
plot.roc(model_glm$trainmodel$pred$obs,
         model_glm$trainmodel$pred$Yes,
         print.auc=TRUE,
         print.auc.x=0.2, 
         print.auc.y=0.7,
         grid=TRUE,
         col=2)
legend("bottomright", 
       legend=c("glm", "cart", "knn"),
       col=c(2:4), 
       lwd=2)
```

## ROCæ›²ç·š

```{r}
#| eval: true
#| echo: false
# Plot roc curve
plot.roc(model_glm$trainmodel$pred$obs,
         model_glm$trainmodel$pred$Yes,
         print.auc=TRUE,
         print.auc.x=0.2, 
         print.auc.y=0.7,
         grid=TRUE,
         col=2)
legend("bottomright", 
       legend=c("glm", "cart", "knn"),
       col=c(2:4), 
       lwd=2)
```

## æ–¹æ³•2: CARTæ±ºç­–æ¨¹
```{r}
#| eval: false
#| echo: true
# æ–¹æ³•2: CARTæ±ºç­–æ¨¹
model_tree <- model("rpart", train, test)

# é¡¯ç¤º accuracy
# summary(model_tree$trainmodel)
model_tree$accuracy # 0.9113136

# Plot roc curve
plot.roc(model_tree$trainmodel$pred$obs,
         model_tree$trainmodel$pred$Yes,
         print.auc=TRUE,
         add=TRUE,
         col=3,
         print.auc.x=0.3, 
         print.auc.y=0.6)
```

## æ–¹æ³•3: KNN(K-è¿‘é„°æ¼”ç®—æ³• K-Nearest Neighbors)
```{r}
#| eval: false
#| echo: true
# æ–¹æ³•3: KNN
model_knn <- model("knn", train, test)

# é¡¯ç¤º accuracy
model_knn$accuracy # 0.9404312

# Plot roc curve
plot.roc(model_knn$trainmodel$pred$obs,
         model_knn$trainmodel$pred$Yes,
         print.auc=TRUE,
         add=TRUE,
         col=4,
         print.auc.x=0.4, 
         print.auc.y=0.5)
```

## ROCæ›²ç·š(GLM, CART, KNN)

```{r}
#| eval: true
#| echo: false

model_glm <- model("glm", train, test)

# Plot roc curve
plot.roc(model_glm$trainmodel$pred$obs,
         model_glm$trainmodel$pred$Yes,
         print.auc=TRUE,
         print.auc.x=0.2, 
         print.auc.y=0.7,
         grid=TRUE,
         col=2)
legend("bottomright", legend=c("glm", "cart", "knn"),
       col=c(2:4), lwd=2)

# æ–¹æ³•2: CARTæ±ºç­–æ¨¹
model_tree <- model("rpart", train, test)

# Plot roc curve
plot.roc(model_tree$trainmodel$pred$obs,
         model_tree$trainmodel$pred$Yes,
         print.auc=TRUE,
         add=TRUE,
         col=3,
         print.auc.x=0.3, 
         print.auc.y=0.6)

# æ–¹æ³•3: KNN
model_knn <- model("knn", train, test)

# Plot roc curve
plot.roc(model_knn$trainmodel$pred$obs,
         model_knn$trainmodel$pred$Yes,
         print.auc=TRUE,
         add=TRUE,
         col=4,
         print.auc.x=0.4, 
         print.auc.y=0.5)
```

## 5.5 ç¿’é¡Œ-Rèˆ‡å°æ˜ç®—å‘½å¸«-shinyå¯¦ä½œç¯‡ {background-image="images/crystal_ball.png"}

-   å¯¦ä½œshinyäººåŠ›è³‡æºå„€è¡¨æ¿

-   å»ºç«‹è³‡æ–™æ‘˜è¦,çµæ§‹,ç¹ªåœ–,ç›£ç£å¼å­¸ç¿’é æ¸¬

-   **è‡ªå‹•ç”¢ç”Ÿå ±è¡¨**çµæœ,å…§å®¹åŒ…æ‹¬ç›£ç£å¼å­¸ç¿’æ¨¡å‹,æ¨¡å‹è¦–è¦ºåŒ–,æ··æ·†çŸ©é™£,ROCæ›²ç·š,é æ¸¬æ­£ç¢ºç‡ç­‰

## 5.6 çµè«–

-   ç†Ÿæ‚‰ readr, dplyr, ggcorrplot, ggplot2, randomForest, caret, pROC å¥—ä»¶

-   ç†è§£ç¬¬4ç« Rèˆ‡å°æ˜ç®—å‘½å¸«çš„è³‡æ–™APCæ–¹æ³•

-   ç¬¬5ç« ç¿’é¡Œ-Rèˆ‡å°æ˜ç®—å‘½å¸«(ä¸‹) ...æœŸå¾…æœ€çµ‚å›ã€ç¬¬6é›†ã€‘

## 

::: {style="text-align: center"}
[THANK YOUğŸ˜ƒ]{style="color: red;"}

-   æŒ‰ è¨‚é–±ğŸ›’ã€è®šğŸ‘‹ã€é–‹å•Ÿå°éˆ´éºğŸ””
-   <a href="https://youtube.com/@alan9956" target="_blank">https://youtube.com/@alan9956</a>
-   <a href="http://rwepa.blogspot.com/" target="_blank">http://rwepa.blogspot.com/</a>

![](images/tail_subscribe) ![](images/tail_rwepa.png) ![](images/tail_lee.png)
:::
